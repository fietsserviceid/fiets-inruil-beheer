<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FSID Beheer Portal</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0078D4">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="stylesheet" href="./style.css">
  <script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./service-worker.js'); }
  </script>
</head>
<body>
  <header class="fsid-header">
    <img src="./logo.png" class="fsid-logo" alt="FSID logo">
    <span class="fsid-title">FSID Beheer Portal</span>
  </header>
  <!-- LOGIN SCREEN -->
  <section id="login-screen" class="card">
    <h1>Inloggen</h1>
    <label for="username">Gebruikersnaam</label>
    <input id="username" autocomplete="username">
    <label for="password">Wachtwoord</label>
    <input id="password" type="password" autocomplete="current-password">
    <button onclick="startLogin()" class="btn-primary">Inloggen</button>
    <p id="login-msg" class="msg"></p>
  </section>
  <!-- 2FA SCREEN -->
  <section id="totp-screen" class="card" style="display:none;">
    <h2>Voer 2FA code in</h2>
    <input id="totp" inputmode="numeric" maxlength="6" style="max-width:140px;">
    <button onclick="verifyTOTP()" class="btn-primary">Bevestigen</button>
    <p id="totp-msg" class="msg"></p>
  </section>
  <main id="app" style="display:none;">
    <nav class="menu">
      <button onclick="showDealers()" class="menu-btn">Dealers</button>
      <button onclick="showCodes()" class="menu-btn">Codes</button>
      <button onclick="openSettings()" class="menu-btn">Instellingen</button>
      <button onclick="logout()" class="menu-btn">Uitloggen</button>
    </nav>
    <!-- DEALERS SCREEN -->
    <section id="dealers-screen" class="card" style="display:none;">
      <h2>Dealers</h2>
      <div class="toolbar">
        <button onclick="newDealer()" class="btn-primary">+ Nieuwe Dealer</button>
        <span id="dealers-status" class="status"></span>
        <div class="spacer"></div>
        <input id="dealerSearch" placeholder="Zoek..." oninput="filterDealers()">
      </div>
      <div class="table-wrap">
        <table id="dealersTable" class="table">
          <thead>
            <tr><th>Naam</th><th>Stad</th><th>Code</th><th>Actief</th><th>Acties</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="dealer-form" class="dealer-form" style="display:none;">
        <h3 id="dealer-form-title">Nieuwe dealer</h3>
        <div class="form-grid">
          <label for="form-name">Naam</label>
          <input id="form-name">
          <label for="form-city">Stad</label>
          <input id="form-city">
          <label for="form-code">Code</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <input id="form-code" style="flex:1">
            <button type="button" class="btn-secondary" onclick="formGenerateCode()">Genereer</button>
          </div>
          <label for="form-active">Actief</label>
          <input id="form-active" type="checkbox">
        </div>
        <div class="toolbar">
          <button id="dealerSaveBtn" onclick="saveDealer()" class="btn-primary">Opslaan</button>
          <button onclick="cancelDealerForm()" class="btn-secondary">Annuleren</button>
        </div>
      </div>
    </section>
    <!-- CODES SCREEN -->
    <section id="codes-screen" class="card" style="display:none;">
      <h2>Installatiecodes</h2>
      <div class="toolbar">
        <button onclick="reloadDealers()" class="btn-secondary">â†» Dealers</button>
        <button onclick="loadCodesFromGitHub()" class="btn-secondary">â†» Herladen</button>
        <button onclick="saveCodesToGitHub()" class="btn-primary">ðŸ’¾ Opslaan naar GitHub</button>
        <span id="codes-status" class="status"></span>
      </div>
      <div id="codes-meta" class="meta"></div>
      <datalist id="dealerNames"></datalist>
      <div class="filter-row">
        <label for="codesSearch">Zoeken:</label>
        <input id="codesSearch" placeholder="code of note..." oninput="filterCodes()">
      </div>
      <div class="table-wrap">
        <table id="codesTable" class="table">
          <thead>
            <tr>
              <th style="width:36%">Code</th>
              <th style="width:34%">Dealer (note)</th>
              <th style="width:10%">Actief</th>
              <th style="width:20%">Vervaldatum</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <dialog id="settingsDialog">
    <h3>Instellingen</h3>
    <div class="form-grid cols-2">
      <h4 style="grid-column:1/3;margin:8px 0 0;">Codes.json (fiets-inruil-calculator)</h4>
      <label for="ghOwner">Owner</label>
      <input id="ghOwner" placeholder="fietsserviceid">
      <label for="ghRepo">Repo</label>
      <input id="ghRepo" placeholder="fiets-inruil-calculator">
      <label for="ghPath">Path</label>
      <input id="ghPath" placeholder="codes.json">
      <label for="ghBranch">Branch</label>
      <input id="ghBranch" placeholder="main">

      <h4 style="grid-column:1/3;margin:12px 0 0;">Dealers.json (beheer repo)</h4>
      <label for="ghDOwner">Owner</label>
      <input id="ghDOwner" placeholder="fietsserviceid">
      <label for="ghDRepo">Repo</label>
      <input id="ghDRepo" placeholder="fiets-inruil-beheer">
      <label for="ghDPath">Path</label>
      <input id="ghDPath" placeholder="docs/dealers.json">
      <label for="ghDBranch">Branch</label>
      <input id="ghDBranch" placeholder="main">

      <label for="ghToken">GitHub Token (contents:write)</label>
      <input id="ghToken" type="password" placeholder="ghp_...">
    </div>
    <small>Token wordt lokaal bewaard (localStorage). Verwijder via Instellingen/Uitloggen.</small>
    <div class="toolbar right">
      <button onclick="saveSettings()" class="btn-primary">Opslaan</button>
      <button onclick="closeSettings()" class="btn-secondary">Sluiten</button>
    </div>
  </dialog>

  <script src="./app.js" defer></script>
</body>
</html>
