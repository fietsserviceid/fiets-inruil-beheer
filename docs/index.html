<!DOCTYPE html>
<html lang='nl'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>FSID Beheer Portal</title>
  <link rel='stylesheet' href='./style.css'>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div id='login-screen'>
    <h1>FSID Beheer Login</h1>
    <label>Gebruikersnaam:</label><br>
    <input id='username'><br><br>
    <label>Wachtwoord:</label><br>
    <input id='password' type='password'><br><br>
    <button onclick='startLogin()'>Inloggen</button>
    <p id='login-msg'></p>
  </div>

  <!-- 2FA SCREEN -->
  <div id='totp-screen' style='display:none;'>
    <h2>Voer 2FA code in</h2>
    <input id='totp' inputmode='numeric' maxlength='6' style='width:120px;'>
    <button onclick='verifyTOTP()'>Bevestigen</button>
    <p id='totp-msg'></p>
  </div>

  <!-- APP SCREEN -->
  <div id='app' style='display:none;'>
    <h1>FSID Beheer Portal</h1>

    <div id='menu'>
      <button onclick='showDealers()'>Dealers</button>
      <button onclick='showCodes()'>Codes</button>
      <button onclick='openSettings()'>Instellingen</button>
      <button onclick='logout()'>Uitloggen</button>
    </div>

    <!-- CODES SCREEN -->
    <div id='codes-screen' style='display:none;'>
      <h2>Installatiecodes (uit fiets-inruil-calculator/codes.json)</h2>
      <div style='margin:6px 0;'>
        <button onclick='loadCodesFromGitHub()'>‚Üª Herladen</button>
        <button onclick='saveCodesToGitHub()'>üíæ Opslaan naar GitHub</button>
        <span id='codes-status' style='margin-left:10px;color:#555'></span>
      </div>
      <div id='codes-meta' style='color:#666; font-size:14px; margin:6px 0;'></div>
      <div style='margin:6px 0;'>
        Zoeken: <input id='codesSearch' oninput='filterCodes()' placeholder='code of note...'>
      </div>
      <table id='codesTable' border='1' cellpadding='6' style='margin-top:8px; width:100%; max-width:1024px;'>
        <thead>
          <tr>
            <th style='width:36%'>Code</th>
            <th style='width:34%'>Note</th>
            <th style='width:10%'>Actief</th>
            <th style='width:20%'>Vervaldatum</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- DEALERS SCREEN (from phase 2) -->
    <div id='dealers-screen' style='display:none;'>
      <h2>Dealers</h2>
      <button onclick='newDealer()'>+ Nieuwe Dealer</button><br><br>
      <input id='dealerSearch' placeholder='Zoek...' oninput='filterDealers()'>

      <table id='dealersTable' border='1' cellpadding='6' style='margin-top:10px;'>
        <thead>
          <tr>
            <th>Naam</th>
            <th>Stad</th>
            <th>Code</th>
            <th>Actief</th>
            <th>Acties</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id='dealer-form' style='display:none; margin-top:20px;'>
        <h3 id='dealer-form-title'>Dealer toevoegen</h3>
        <label>Naam:</label><br>
        <input id='form-name' style='width:300px;'><br><br>
        <label>Stad:</label><br>
        <input id='form-city' style='width:300px;'><br><br>
        <label>Code:</label><br>
        <input id='form-code' style='width:200px;'><br><br>
        <label>Actief:</label>
        <input type='checkbox' id='form-active'><br><br>
        <button onclick='saveDealer()'>Opslaan</button>
        <button onclick='cancelDealerForm()'>Annuleren</button>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <dialog id='settingsDialog'>
    <h3>GitHub instellingen voor codes.json</h3>
    <label>Owner:</label><br>
    <input id='ghOwner' style='width:280px'><br><br>
    <label>Repo:</label><br>
    <input id='ghRepo' style='width:280px'><br><br>
    <label>Path (bestand):</label><br>
    <input id='ghPath' style='width:280px'><br><br>
    <label>Branch:</label><br>
    <input id='ghBranch' style='width:180px'><br><br>
    <label>GitHub Token (fine-grained, contents:write):</label><br>
    <input id='ghToken' type='password' style='width:380px'><br>
    <small>‚ö†Ô∏è Token wordt alleen in deze sessie bewaard (sessionStorage) en nooit in het bestand opgeslagen.</small>
    <div style='margin-top:12px;'>
      <button onclick='saveSettings()'>Opslaan</button>
      <button onclick='closeSettings()'>Sluiten</button>
    </div>
  </dialog>

  <script src='./app.js' defer></script>
</body>
</html>
